<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    
    
    <title>Scan Files - DetRan</title>
</head>
<body>
    <!-- Animated Background Particles -->
    <div class="particles" id="particles"></div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <a href="index.html" style="display: flex; align-items: center; gap: 0.5rem; text-decoration: none;">
                    <svg class="logo-icon" width="24" height="24" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11.5C15.4,11.5 16,12.1 16,12.7V16.5C16,17.1 15.4,17.7 14.8,17.7H9.2C8.6,17.7 8,17.1 8,16.5V12.6C8,12 8.6,11.4 9.2,11.4V10C9.2,8.6 10.6,7 12,7M12,8.2C11.2,8.2 10.5,8.7 10.5,9.5V11.5H13.5V9.5C13.5,8.7 12.8,8.2 12,8.2Z"/>
                    </svg>
                    <span class="logo-text">DETRAN</span>
                </a>
            </div>
            <ul class="nav-links">
                <li><a href="index.html" class="nav-link">HOME</a></li>
                <li><a href="scan.html" class="nav-link active">SCAN</a></li>
                <li><a href="index.html#features" class="nav-link">FEATURES</a></li>
                <li><a href="index.html#about" class="nav-link">ABOUT</a></li>
                <li><a href="index.html#contact" class="nav-link">CONTACT</a></li>
            </ul>
            <button class="mobile-toggle" id="mobileToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Scan Page Content -->
    <section class="scan-page">
        <div class="scan-container">
            <div class="scan-header">
                <div class="scan-badge">THREAT DETECTION</div>
                <h1 class="scan-title">SCAN YOUR FILES</h1>
                <p class="scan-subtitle">Upload your files to detect ransomware and malicious threats using our AI-powered analysis engine</p>
            </div>

            <!-- Upload Section -->
            <div class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                    </div>
                    <h3 class="upload-title">Drop files here or click to browse</h3>
                    <p class="upload-subtitle">Supports all file types ‚Ä¢ Max 100MB per file</p>
                </div>

                <div class="upload-options">
                    <button class="upload-option-btn" id="filesBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        <span>Select Files</span>
                    </button>
                    <button class="upload-option-btn" id="folderBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"/>
                        </svg>
                        <span>Select Folder</span>
                    </button>
                </div>

                <input type="file" class="file-input" id="fileInput" multiple>
                <input type="file" class="file-input" id="folderInput" webkitdirectory>
                
                <div class="file-list" id="fileList"></div>
                
                <button class="btn-primary scan-btn" id="scanBtn" style="display: none;">
                    <svg class="btn-icon" width="20" height="20" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M15.5,14L20.5,19L19,20.5L14,15.5V14.71L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14Z"/>
                    </svg>
                    <span>SCAN FILES FOR THREATS</span>
                    <span class="btn-glow"></span>
                </button>
            </div>

            <!-- Security Info Cards -->
            <div class="security-info">
                <div class="info-card">
                    <svg class="info-icon" width="32" height="32" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
                    </svg>
                    <h4>Secure Processing</h4>
                    <p>All files are encrypted and processed securely</p>
                </div>
                <div class="info-card">
                    <svg class="info-icon" width="32" height="32" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M13.5,8H12V13L16.28,15.54L17,14.33L13.5,12.25V8M13,3A9,9 0 0,0 4,12H1L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3"/>
                    </svg>
                    <h4>Fast Analysis</h4>
                    <p>Results delivered in seconds with high accuracy</p>
                </div>
                <div class="info-card">
                    <svg class="info-icon" width="32" height="32" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"/>
                    </svg>
                    <h4>Auto Delete</h4>
                    <p>Files automatically deleted after scanning</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo">
                <svg class="logo-icon" width="24" height="24" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11.5C15.4,11.5 16,12.1 16,12.7V16.5C16,17.1 15.4,17.7 14.8,17.7H9.2C8.6,17.7 8,17.1 8,16.5V12.6C8,12 8.6,11.4 9.2,11.4V10C9.2,8.6 10.6,7 12,7M12,8.2C11.2,8.2 10.5,8.7 10.5,9.5V11.5H13.5V9.5C13.5,8.7 12.8,8.2 12,8.2Z"/>
                </svg>
                <span class="logo-text">DETRAN</span>
            </div>
            <p class="footer-text">¬© 2024 DetRan. All rights reserved. Protecting your digital world.</p>
        </div>
    </footer>

    <!-- Scanning Overlay -->
    <div class="scanning-overlay" id="scanningOverlay">
        <div class="scanning-content">
            <div class="scanner-wrapper">
                <div class="scanner-ring"></div>
                <div class="scanner-ring"></div>
                <div class="scanner-ring"></div>
                <div class="scanner-center">
                    <svg width="48" height="48" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M15.5,14L20.5,19L19,20.5L14,15.5V14.71L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14Z"/>
                    </svg>
                </div>
            </div>
            <h3 class="scanning-text">SCANNING FILES...</h3>
            <p class="scanning-subtext">Analyzing for potential threats</p>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
        </div>
    </div>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Main JavaScript -->
        <!-- Main JavaScript -->
    <script>
        // Particle Animation
        function createParticles() {
            const particles = document.getElementById('particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
                particles.appendChild(particle);
            }
        }

        // Mobile Menu Toggle
        const mobileToggle = document.getElementById('mobileToggle');
        const navLinks = document.querySelector('.nav-links');
        
        mobileToggle.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            mobileToggle.classList.toggle('active');
        });

        // File Upload Logic
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const folderInput = document.getElementById('folderInput');
        const filesBtn = document.getElementById('filesBtn');
        const folderBtn = document.getElementById('folderBtn');
        const fileList = document.getElementById('fileList');
        const scanBtn = document.getElementById('scanBtn');
        const scanningOverlay = document.getElementById('scanningOverlay');
        let files = [];

        // Files button - select individual files
        filesBtn.addEventListener('click', () => {
            fileInput.click();
        });

        // Folder button - select entire folder
        folderBtn.addEventListener('click', () => {
            folderInput.click();
        });

        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        // Handle drag over
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('drag-over');
        });

        // Handle drop
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            handleFiles(e.dataTransfer.files);
        });

        // Handle file input change
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
            fileInput.value = ''; // Reset input
        });

        // Handle folder input change
        folderInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
            folderInput.value = ''; // Reset input
        });

        function handleFiles(selectedFiles) {
            Array.from(selectedFiles).forEach(file => {
                if (!files.some(f => f.name === file.name)) {
                    files.push(file);
                    addFileToList(file);
                }
            });
            
            if (files.length > 0) {
                scanBtn.style.display = 'flex';
                setTimeout(() => scanBtn.classList.add('show'), 10);
            }
        }

        function addFileToList(file) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            
            const fileInfo = document.createElement('div');
            fileInfo.className = 'file-info';
            
            const fileIcon = document.createElement('div');
            fileIcon.className = 'file-icon-badge';
            fileIcon.innerHTML = getFileIcon(file.name);
            
            const fileDetails = document.createElement('div');
            fileDetails.className = 'file-details';
            
            const fileName = document.createElement('div');
            fileName.className = 'file-name';
            fileName.textContent = file.name;
            
            const fileSize = document.createElement('div');
            fileSize.className = 'file-size';
            fileSize.textContent = formatFileSize(file.size);
            
            fileDetails.appendChild(fileName);
            fileDetails.appendChild(fileSize);
            fileInfo.appendChild(fileIcon);
            fileInfo.appendChild(fileDetails);
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'file-remove';
            removeBtn.innerHTML = '‚úï';
            removeBtn.onclick = () => removeFile(file, fileItem);
            
            fileItem.appendChild(fileInfo);
            fileItem.appendChild(removeBtn);
            
            // Insert at the beginning instead of appending
            fileList.insertBefore(fileItem, fileList.firstChild);
            
            setTimeout(() => fileItem.classList.add('show'), 10);
        }

        function removeFile(file, element) {
            files = files.filter(f => f !== file);
            element.classList.remove('show');
            setTimeout(() => {
                fileList.removeChild(element);
                if (files.length === 0) {
                    scanBtn.classList.remove('show');
                    setTimeout(() => scanBtn.style.display = 'none', 300);
                }
            }, 300);
        }

        function getFileIcon(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            const icons = {
                pdf: '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M5,4H15L20,9V19A2,2 0 0,1 18,21H5A2,2 0 0,1 3,19V5A2,2 0 0,1 5,3M5,5V19H18V10H13V5H5Z"/></svg>',
                doc: '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M5,4H15L20,9V19A2,2 0 0,1 18,21H5A2,2 0 0,1 3,19V5A2,2 0 0,1 5,3M5,5V19H18V10H13V5H5Z"/></svg>',
                docx: '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M5,4H15L20,9V19A2,2 0 0,1 18,21H5A2,2 0 0,1 3,19V5A2,2 0 0,1 5,3M5,5V19H18V10H13V5H5Z"/></svg>',
                xls: '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>',
                xlsx: '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>',
                jpg: '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>',
                jpeg: '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>',
                png: '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>',
                gif: '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>',
                zip: '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>',
                rar: '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>',
                mp4: '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z"/></svg>',
                avi: '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z"/></svg>',
                mp3: '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M12,3V12.26C11.5,12.09 11,12 10.5,12C8,12 6,14 6,16.5C6,19 8,21 10.5,21C13,21 15,19 15,16.5V6H19V3H12Z"/></svg>',
                txt: '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>'
            };
            return icons[ext] || '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Scan Files
        scanBtn.addEventListener('click', async () => {
            if (files.length === 0) return;
            scanningOverlay.classList.add('active');

            const formData = new FormData();
            files.forEach(file => formData.append("file", file));

            try {
                // CHANGED: Using localhost:5000 instead of BACKEND_URL
                const uploadRes = await fetch("http://localhost:5000/upload", {
                    method: "POST",
                    body: formData
                });

                const uploaded = await uploadRes.json();
                const filePaths = uploaded.saved.map(name => `uploads/${name}`);

                // CHANGED: Using localhost:5000 instead of BACKEND_URL
                const scanRes = await fetch("http://localhost:5000/scan_selected", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ files: filePaths })
                });

                const scanResult = await scanRes.json();
                scanningOverlay.classList.remove('active');
                showScanResults(scanResult);

            } catch (err) {
                scanningOverlay.classList.remove('active');
                Swal.fire({
                    title: "‚ùå Connection Error",
                    text: "Backend not responding. Make sure Flask is running on localhost:5000.",
                    icon: "error",
                    confirmButtonText: "OK",
                    confirmButtonColor: "#ef4444",
                    background: "#1a1a2e",
                    color: "#fff"
                });
            }
        });

        function showScanResults(result) {
            const infected = result.files.filter(f => f.infected === true);
            
            if (infected.length > 0) {
                let fileListHTML = "<ul style='text-align:left; margin: 15px 0; padding-left: 20px;'>";
                infected.forEach(file => {
                    fileListHTML += `<li style='margin: 8px 0;'><b>${file.path}</b></li>`;
                });
                fileListHTML += "</ul>";

                Swal.fire({
                    title: "‚ö†Ô∏è THREAT DETECTED!",
                    html: `
                        <p style='margin: 15px 0;'>The following file(s) appear to be <b style='color: #ef4444;'>infected or suspicious</b>:</p>
                        ${fileListHTML}
                        <p style="margin-top: 15px; padding: 15px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border-left: 4px solid #ef4444;">
                            ‚ö†Ô∏è It is recommended to quarantine or remove these files immediately.
                        </p>
                    `,
                    icon: "error",
                    confirmButtonText: "UNDERSTOOD",
                    confirmButtonColor: "#ef4444",
                    background: "#1a1a2e",
                    color: "#fff",
                    customClass: {
                        popup: 'swal-custom'
                    }
                }).then(() => {
                    // Clear files after showing results
                    files = [];
                    fileList.innerHTML = '';
                    scanBtn.classList.remove('show');
                    setTimeout(() => scanBtn.style.display = 'none', 300);
                });
            } else {
                Swal.fire({
                    title: "‚úÖ ALL CLEAR!",
                    html: `
                        <p style='margin: 15px 0; font-size: 16px;'>No threats detected. Your files are safe.</p>
                        <p style="margin-top: 15px; padding: 15px; background: rgba(52, 211, 153, 0.1); border-radius: 8px; border-left: 4px solid #34d399;">
                            üõ°Ô∏è All scanned files passed security checks.
                        </p>
                    `,
                    icon: "success",
                    confirmButtonText: "GREAT!",
                    confirmButtonColor: "#34d399",
                    background: "#1a1a2e",
                    color: "#fff",
                    customClass: {
                        popup: 'swal-custom'
                    }
                }).then(() => {
                    // Clear files after showing results
                    files = [];
                    fileList.innerHTML = '';
                    scanBtn.classList.remove('show');
                    setTimeout(() => scanBtn.style.display = 'none', 300);
                });
            }
        }

        // Initialize
        createParticles();
    </script>
</html>